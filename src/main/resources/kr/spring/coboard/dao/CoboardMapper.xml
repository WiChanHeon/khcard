<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.coboard.dao.CoboardMapper">  
	
	<select id="getCoboardList" parameterType="map" resultType="coboardCommand">
		
		SELECT
		  co_num,
		  m_id,
		  m_name,
		  co_title,
		  to_char(co_reg,'YYYY-MM-DD HH24:MI:SS') co_reg,
		  co_hit,
		  co_sort,
		  co_re_count
		FROM
			(SELECT
				a.*,
				rownum rnum
			FROM
				(SELECT
					*
				FROM f_coboard b LEFT JOIN
					(SELECT co_num, count(*) co_re_count FROM f_coboard_re GROUP BY co_num)r USING(co_num)
					<where>
						<if test="keyword!='' and keyfield=='co_title'">
							co_title like '%' || #{keyword} || '%'
						</if>
						<if test="keyword!='' and keyfield=='co_content'">
							co_content like '%' || #{keyword} || '%'
						</if>
						<if test="keyword!='' and keyfield=='m_id'">
							m_id like '%' || #{keyword} || '%'
						</if>
						<if test="keyword!='' and keyfield=='m_name'">
							m_name like '%' || #{keyword} || '%'
						</if>
						<if test="keyword!='' and keyfield=='all'">
							co_title like '%' || #{keyword} || '%' or
							co_content like '%' || #{keyword} || '%' or  
							m_id like '%' || #{keyword} || '%' or 
							m_name like '%' || #{keyword} || '%'
						</if>
		  			</where>
				ORDER BY co_reg DESC)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
		
	</select>
	
	<select id="getCoboardCount" parameterType="map" resultType="integer">
		SELECT
		  count(*)
		FROM f_coboard
			<where>
				<if test="keyword!='' and keyfield=='co_title'">
					co_title like '%' || #{keyword} || '%'
				</if>
				<if test="keyword!='' and keyfield=='co_content'">
					co_content like '%' || #{keyword} || '%'
				</if>
				<if test="keyword!='' and keyfield=='m_id'">
					m_id like '%' || #{keyword} || '%'
				</if>
				<if test="keyword!='' and keyfield=='m_name'">
					m_name like '%' || #{keyword} || '%'
				</if>
				<if test="keyword!='' and keyfield=='all'">
					co_title like '%' || #{keyword} || '%' or
					co_content like '%' || #{keyword} || '%' or  
					m_id like '%' || #{keyword} || '%' or 
					m_name like '%' || #{keyword} || '%'
				</if>
			</where>
	</select>
	
	
	<select id="getCoboardReplyList" parameterType="map" resultType="coboardReplyCommand">
		
		SELECT
		  co_re_num,
		  co_num,
		  m_id,
		  m_name,
		  to_char(co_re_reg,'YYYY-MM-DD HH24:MI:SS') co_re_reg,
		  co_re_content
		FROM
			(SELECT
				a.*,
				rownum rnum
			FROM
				(SELECT
					*
				FROM f_coboard_re WHERE co_num = #{co_num} ORDER BY co_re_reg DESC)a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
		
	</select>

</mapper>